#!/usr/bin/env bash

signupheat() {
# Changes the line after "userCount < 30" and sets the allowed number of sign ups to 300
SED="sed -Ei -e '/userCount < 30\)/{N;s/(.*allowed\s*=)\s*[0-9]+/\1 "$1"/;}' "$ZENV_SERVERDIR"/web/www/include/velocity_police/velocity_police_ip_signup.php"

# Prints out the newly set value
CAT="cat "$ZENV_SERVERDIR"/web/www/include/velocity_police/velocity_police_ip_signup.php | grep 'userCount < 30)' -A 1 -m 3" 
ssh -t "$ZENV_LDAP_USERNAME"@"$ZENV_DEVSERVER" "$SED;$CAT"
}

input="$1"
default_value=300

# Zenv Statup checks
if [ -z "$ZENV_INITIALIZED" ]; then
    echo 'You must run this program from within ZEnv.'
    exit 1
elif [ -z "$ZENV_CURRENT_WORK" ]; then
    echo 'You must set a workspace before setting the signup heat'
    exit 1

# Show help statement
elif [ "$input" = "--help" ]; then
    echo -e "     [--help]\n"
    echo "Sets signupheat to allow specified number of signups per day"
    echo "usage: set_creation_heat [INTEGER] - defaults to 300"
    exit 1

# Check if no arguments are specified and use default value in this case
elif [ "${#input}" -eq 0 ] ;then
    echo -e "Choosing default value 300"
    input="$default_value"

# Check if input is a positive integer
elif [ "${input//[0-9]}" != "" ]; then
    echo -e "please enter a positive integer as the argument"
    exit 1

fi

signupheat "$input"

