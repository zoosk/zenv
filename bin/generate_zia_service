#! /usr/bin/env bash

# Usage information
if [ "$1" == '-h' -o "$1" == '--help' ]; then
    PROGNAME=$(basename $0)
    echo "${PROGNAME}: generate a new zia service"
    echo "Usage: ${PROGNAME} product Product toolsVersion devId mysqlDBName mysqlDBSuffix useSequentialWorkflow cassandraDBName appFolder"
    echo "requires Maven 3 and Java 7"
    echo "see https://f.corp.zoosk.com/default.asp?W2377 for more information"
    exit 1
fi

# Startup checks
if [ -z "$ZENV_INITIALIZED" ]; then
    echo 'You must run this program from within ZEnv.'
    exit 1
fi

# make sure we have the right parameters
if [ "$#" -lt 9 ]
then
    wget http://nexus.sfo2.zoosk.com:8081/nexus/service/local/repositories/releases/content/gen_zia_service-0.0.4.jar
    java -jar gen_zia_service-0.0.4.jar
    exit 1
fi
product=$1
productName=$2
toolsVersion=$3
devId=$4
mysqlDBName=$5
mysqlDBSuffix=$6
useSequentialWorkflow=$7
cassandraDBName=$8
appFolder=$9
if [ -d "$appFolder" ] 
then
	cd $appFolder
	mkdir $product
	mvn archetype:generate -DinteractiveMode=false -DarchetypeGroupId=com.zoosk.service -DarchetypeArtifactId=zia-archetype -DarchetypeVersion=0.0.4 -DgroupId=com.zoosk.service -DartifactId=$product -Dpackage=com.zoosk.service.${product} -Dversion=0.1.0-SNAPHOT -Dproduct=$product -DproductName=$productName -DtoolsVersion=$toolsVersion -DdevId=$devId -DmysqlDBName=$mysqlDBName -DmysqlDBSuffix=$mysqlDBSuffix -DuseSequentialWorkflow=$useSequentialWorkflow -DcassandraDBName=$cassandraDBName
	cd $product
	mvn clean compile install
else
	echo "either $appFolder does not exist or is not a directory"
fi
