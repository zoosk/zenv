#! /usr/bin/env bash

# Startup checks
if [ -z "$ZENV_INITIALIZED" ]; then
    echo 'You must run this program from within ZEnv.'
    exit 1
fi

NTITLE='';
NMSG='';
NTIME=2;

while getopts "t:m:" arg; do
  case $arg in
    t)
      NTITLE="${OPTARG}"
      ;;
    m)
      NMSG="${OPTARG}"
      ;;
  esac
done


if [ -z "${NTITLE}" ] && [ -z "${NMSG}" ]; then
  NMSG="{$1}";
  if [ -z "${NMSG}" ]; then exit 0; fi
fi

NOTIFY_DE="${XDG_CURRENT_DESKTOP}";

# echo "NTITLE: ${NTITLE} | NMSG: ${NMSG} | NOTIFY_DE: ${NOTIFY_DE}"
case "${NOTIFY_DE}" in
  '')
    BIN_FILE="${ZENV_ROOT}/utils/terminal-notifier.app/Contents/MacOS/terminal-notifier"
    if [ ! -z "${BIN_FILE}" ]; then
      $BIN_FILE -title "${NTITLE}" -message "${NMSG}";
    fi
    ;;
  Unity)
    if [ ! -z $(which notify-send) ]; then
      notify_send "${NTITLE}" "${NMSG}" -t "${NTIME}";
    fi
    ;;
  KDE)
    if [ ! -z $(which kdialog) ]; then
      kdialog --title "${NTITLE}" --passivepopup "${NMSG}" "${NTIME}";
    fi
    ;;
esac
