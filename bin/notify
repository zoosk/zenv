#! /usr/bin/env bash

# Cross-platform OSX / Linux notification utility

# Startup checks
if [ -z "$ZENV_INITIALIZED" ]; then
    echo 'You must run this program from within ZEnv.'
    exit 1
fi

NTITLE=''; # Title
NMSG='';   # Message
NTIME=2;   # Residency time

# Set title and message per options
while getopts "t:m:" arg; do
  case $arg in
    t)
      NTITLE="${OPTARG}"
      ;;
    m)
      NMSG="${OPTARG}"
      ;;
  esac
done

# If no options provided, use the first argument as the mssage
if [ -z "${NTITLE}" ] && [ -z "${NMSG}" ]; then
  NMSG="{$1}";
  if [ -z "${NMSG}" ]; then exit 0; fi
fi

# This environment variable should be set for all Linux distros
# and will provide 'KDE', 'UNITY', 'GNOME', etc
NOTIFY_DE="${XDG_CURRENT_DESKTOP}";

case "${NOTIFY_DE}" in
  '') # OSX
    BIN_FILE="${ZENV_ROOT}/utils/terminal-notifier.app/Contents/MacOS/terminal-notifier"
    if [ ! -z "${BIN_FILE}" ]; then
      $BIN_FILE -title "${NTITLE}" -message "${NMSG}";
    fi
    ;;
  KDE) # KDE, of course
    if [ ! -z $(which kdialog) ]; then
      kdialog --title "${NTITLE}" --passivepopup "${NMSG}" "${NTIME}";
    fi
    ;;
  *) # Unity, Gnome, etc
    if [ ! -z $(which notify-send) ]; then
      notify_send "${NTITLE}" "${NMSG}" -t "${NTIME}";
    fi
    ;;
esac
