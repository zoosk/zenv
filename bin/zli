#! /usr/bin/env bash

if [ "$(python -c 'import zli' 2>/dev/null; echo $?)" == '1' ]; then
    ZLI_INSTALLED=''
else
    ZLI_INSTALLED='yes'
fi

ZLI_BIN="/usr/local/bin/zli"

# Usage information
if [ "$1" == '-h' -o "$1" == '--help' ]; then
    # Print the real zli help if it's already installed
    if [ -n "$ZLI_INSTALLED" ]; then
        $ZLI_BIN --help
    else
        echo 'zli: simulate Zoosk user creation, user interactions, query data, and more.'
        echo 'Run zli from within ZEnv for more detailed usage.'
    fi
    exit 1
fi

# Make sure the environment is available
if [ -z "$ZENV_INITIALIZED" ]; then
    echo 'You must run this program from within ZEnv.'
    exit 1
fi

# Install the dependencies if they are not
if [ -z "$ZLI_INSTALLED" ]; then
    echo 'You need to install zli before using it. If prompted, please type your sudo password below.'
    cd ${ZENV_ROOT}/utils
    if [ ! -d zli ]; then
        git clone git@g.zoosk.com:merrickp/zli.git
    fi
    cd zli
    sudo ARCHFLAGS=-Wno-error=unused-command-line-argument-hard-error-in-future python setup.py develop
fi

$ZLI_BIN $@
